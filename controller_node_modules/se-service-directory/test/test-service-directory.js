'use strict';

var chai             = require('chai');
var expect           = chai.expect;
var ServiceDirectory = require('..');
var netUtils  = require('se-common-utils').netUtils;



describe('the service-directory module', function() {

  it('should list connection info for well-known services', function(done) {

    process.env.DB_CONNECTION_URI = 'mongodb://localhost:27017/foo-bar';
    process.env.LOGS_DB_CONNECTION_URI = 'mongodb://localhost:27017/foo-bar-logs';

    ServiceDirectory({}, function(err, directory) {
      if (err) { throw err; }
      var myAddress = netUtils.getNetworkAddress();
      expect(directory.self).to.be.deep.equal({host: myAddress});
      expect(directory.redis).to.be.deep.equal({host: 'localhost', port: '6379'});
      expect(directory.serverApp).to.be.deep.equal({host: myAddress, port: '3000'});
      expect(directory.controllerProxy).to.be.deep.equal({
        'ws' : { host: myAddress, port: '9000'},
        'http' : { host: myAddress, port: '3002'},
      });
      expect(directory.mongo).to.be.deep.equal({
        dbUri : process.env.DB_CONNECTION_URI,
        logsDbUri : process.env.LOGS_DB_CONNECTION_URI,
      });

      done();
    })


  });


});
